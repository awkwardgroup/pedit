var PEDIT=PEDIT||{};PEDIT={mouseStartX:0,mouseStartY:0,mouseEndX:0,mouseEndY:0,isTouchDevice:!1,init:function(a){var b=document.getElementById(a);return this.isTouchDevice=PEDIT.tools.isTouchDevice(),new PEDIT.Editor(b)},Editor:function(a){var b=this;b.element=a,b.width=a.offsetWidth,b.height=a.offsetHeight,b.offset=0,b.remove=!0,b.resize=!0,b.percent=!0,b.updateChildMaxSize=!0,b.childMaxWidth=0,b.childMaxHeight=0,b.childMinWidth=10,b.childMinHeight=10,b.childTrailID=1,b.moveDoneFunction=null,b.resizeDoneFunction=null,b.removeDoneFunction=null,b.childRenderedFunction=null,b.children={},PEDIT.events.mouseDown(b.element,function(a){a=a||window.event;var c=PEDIT.tools.getPageXY(a);PEDIT.mouseStartX=c[0],PEDIT.mouseStartY=c[1],PEDIT.mouseEndX=c[0],PEDIT.mouseEndY=c[1],b.width=b.element.offsetWidth,b.height=b.element.offsetHeight,b.updateChildMaxSize&&(b.childMaxWidth=100,b.childMaxHeight=100)}),b.render=function(){for(var a=b.element.children,c=[],d=0,e=a.length;e>d;d++)a[d].getAttribute("data-child-id")||c.push(a[d]);for(d=0;d<c.length;d++)b.createChild(c[d])},b.createChild=function(a){var c=new PEDIT.Child(b,a,b.childTrailID);return b.children[b.childTrailID]=c,a.setAttribute("data-child-id",b.childTrailID),b.childTrailID++,c},b.calculateSize=function(a,c){var d=a/(b.width-b.offset)*100;return c||(d=a/(b.height-b.offset)*100),d},b.getChild=function(a){return b.children[a]},b.clean=function(){b.childTrailID=1;for(var a in b.children)b.children.hasOwnProperty(a)&&b.children[a].remove()}},Child:function(a,b,c){function d(){e.width=a.calculateSize(b.offsetWidth,!0),e.height=a.calculateSize(b.offsetHeight,!1),e.offsetX=a.calculateSize(b.offsetLeft,!0),e.offsetY=a.calculateSize(b.offsetTop,!1),e.element.style.width=e.width+"%",e.element.style.height=e.height+"%",e.editor.resize&&(e.elementResize=document.createElement("div"),e.elementResize.className="resize",e.element.appendChild(e.elementResize)),e.editor.remove&&(e.elementRemove=document.createElement("div"),e.elementRemove.className="remove",e.element.appendChild(e.elementRemove)),PEDIT.events.mouseDown(e.element,function(){e.updateOffsetLimits(),e.move()}),e.elementResize&&PEDIT.events.mouseDown(e.elementResize,function(){e.locked=!0,e.resize()}),e.elementRemove&&PEDIT.events.mouseDown(e.elementRemove,function(b){b=b||window.event,PEDIT.isTouchDevice&&b.preventDefault(),e.locked=!0,PEDIT.events.mouseUp(e.elementRemove,function(){e.remove(),"function"==typeof a.removeDoneFunction&&a.removeDoneFunction(e)}),PEDIT.events.mouseUp(document,function(){e.locked=!1})}),"function"==typeof a.childRenderedFunction&&a.childRenderedFunction(e)}var e=this;if(e.id=c,e.element=b,e.elementResize=null,e.elementRemove=null,e.editor=a,e.locked=!1,images=b.getElementsByTagName("img"),"undefined"!=typeof images[0])var f=setInterval(function(){images[0].complete&&(d(),clearInterval(f))},10);else d();e.updateOffsetLimits=function(){e.offsetLimitX=100-e.width,e.offsetLimitY=100-e.height},e.move=function(){var b=e.offsetX,c=e.offsetY;if(!e.locked){var d=function(d){d=d||window.event,PEDIT.isTouchDevice&&d.preventDefault();var f=PEDIT.tools.getPageXY(d);PEDIT.mouseEndX=f[0],PEDIT.mouseEndY=f[1],b=e.offsetX+a.calculateSize(PEDIT.mouseEndX-PEDIT.mouseStartX,!0),b=0>b?0:b,b=b>e.offsetLimitX?e.offsetLimitX:b,e.element.style.left=b+"%",c=e.offsetY+a.calculateSize(PEDIT.mouseEndY-PEDIT.mouseStartY,!1),c=0>c?0:c,c=c>e.offsetLimitY?e.offsetLimitY:c,e.element.style.top=c+"%"};PEDIT.events.mouseMove(document,d);var f=function(){PEDIT.events.mouseMove(document,d,!0),PEDIT.events.mouseUp(document,f,!0),e.offsetX=b,e.offsetY=c,"function"==typeof a.moveDoneFunction&&a.moveDoneFunction(e)};PEDIT.events.mouseUp(document,f)}},e.resize=function(){var b=function(b){b=b||window.event,PEDIT.isTouchDevice&&b.preventDefault();var c=PEDIT.tools.getPageXY(b);PEDIT.mouseStartX=c[0],PEDIT.mouseStartY=c[1];var d=e.height/e.width,f=PEDIT.mouseStartX-PEDIT.mouseEndX,g=f*f,h=PEDIT.mouseStartY-PEDIT.mouseEndY,i=h*h,j=1.5*Math.sqrt(g+i);j=f>=0&&h>=0?j:-j;var k=e.width+a.calculateSize(j,!0),l=d*k;e.updateElementSize(k,l),PEDIT.mouseEndX=c[0],PEDIT.mouseEndY=c[1]};PEDIT.events.mouseMove(document,b);var c=function(){PEDIT.events.mouseMove(document,b,!0),PEDIT.events.mouseUp(document,c,!0),e.locked=!1,"function"==typeof a.resizeDoneFunction&&a.resizeDoneFunction(e)};PEDIT.events.mouseUp(document,c)},e.updateElementSize=function(a,b){if(!(a>e.editor.childMaxWidth||a<e.editor.childMinWidth||b>e.editor.childMaxHeight||b<e.editor.childMinHeight)){var c=a-e.width,d=b-e.height;c>0?(e.width=a>99?100:a,e.height=b>99?100:b):(e.width=a,e.height=b),e.updateOffsetLimits(),e.element.style.width=e.width+"%",e.element.style.height=e.height+"%";var f=e.offsetX-c/2,g=e.offsetY-d/2;e.updateElementPosition(f,g)}},e.updateElementPosition=function(a,b){a=0>a?0:a>e.offsetLimitX?e.offsetLimitX:a,b=0>b?0:b>e.offsetLimitY?e.offsetLimitY:b,e.element.style.left=a+"%",e.element.style.top=b+"%",e.offsetX=a,e.offsetY=b},e.remove=function(){e.editor.element.removeChild(e.element),delete e.editor.children[e.id]}}},PEDIT.events={mouseDown:function(a,b,c){this.bindEvent("down",a,b,c)},mouseUp:function(a,b,c){this.bindEvent("up",a,b,c)},mouseMove:function(a,b,c){this.bindEvent("move",a,b,c)},bindEvent:function(a,b,c,d){PEDIT.isTouchDevice?"down"===a?d?b.removeEventListener("touchstart",c,!1):b.addEventListener("touchstart",c,!1):"up"===a?d?b.removeEventListener("touchend",c,!1):b.addEventListener("touchend",c,!1):"move"===a&&(d?b.removeEventListener("touchmove",c,!1):b.addEventListener("touchmove",c,!1)):"down"===a?b.onmousedown=d?null:c:"up"===a?b.onmouseup=d?null:c:"move"===a&&(b.onmousemove=d?null:c)}},PEDIT.tools={isTouchDevice:function(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}},getPageXY:function(a){return"undefined"!=typeof a.touches?[a.touches[0].pageX,a.touches[0].pageY]:[a.x,a.y]},addTouchClass:function(a){var b=(" "+document.body.className+" ").indexOf(" "+a+" ")>-1;!b&&PEDIT.isTouchDevice&&(document.body.className+=""!==document.body.className?" "+a:a)},console:function(a,b){var c=document.getElementById("debug").innerHTML;c=b?a+"<br>"+c:a,document.getElementById("debug").innerHTML=c}};