var PEDIT=PEDIT||{};PEDIT={mouseStartX:0,mouseStartY:0,mouseEndX:0,mouseEndY:0,isTouchDevice:!1,init:function(a){var b=document.getElementById(a);return this.isTouchDevice=PEDIT.tools.isTouchDevice(),new PEDIT.Editor(b)},Editor:function(a){var b=this;b.element=a,b.width=a.offsetWidth,b.height=a.offsetHeight,b.offset=0,b.remove=!0,b.resize=!0,b.percent=!0,b.updateChildMaxSize=!0,b.childMaxWidth=0,b.childMaxHeight=0,b.childMinWidth=10,b.childMinHeight=10,b.childTrailID=1,b.moveDoneFunction=null,b.resizeDoneFunction=null,b.children=[],PEDIT.events.mouseDown(b.element,function(a){a=a||window.event;var c=PEDIT.tools.getPageXY(a);PEDIT.mouseStartX=c[0],PEDIT.mouseStartY=c[1],PEDIT.mouseEndX=c[0],PEDIT.mouseEndY=c[1],b.width=b.element.offsetWidth,b.height=b.element.offsetHeight,b.updateChildMaxSize&&(b.childMaxWidth=100,b.childMaxHeight=100)}),b.render=function(){for(var a=b.element.children,c=[],d=0,e=a.length;e>d;d++)a[d].getAttribute("data-child-id")||c.push(a[d]);for(d=0;d<c.length;d++)b.addChild(c[d])},b.addChild=function(a){var c=new PEDIT.Child(b,a,b.childTrailID);return b.children[b.childTrailID]=c,a.setAttribute("data-child-id",b.childTrailID),b.childTrailID++,c},b.calculateSize=function(a,c){var d=a/(b.width-b.offset)*100;return c||(d=a/(b.height-b.offset)*100),d}},Child:function(a,b,c){var d=this;d.id=c,d.element=b,d.elementResize=null,d.elementRemove=null,d.editor=a,d.width=a.calculateSize(b.offsetWidth,!0),d.height=a.calculateSize(b.offsetHeight,!1),d.offsetX=a.calculateSize(b.offsetLeft,!0),d.offsetY=a.calculateSize(b.offsetTop,!1),d.locked=!1,d.editor.resize&&(d.elementResize=document.createElement("div"),d.elementResize.className="resize",d.element.appendChild(d.elementResize)),d.editor.remove&&(d.elementRemove=document.createElement("div"),d.elementRemove.className="remove",d.element.appendChild(d.elementRemove)),PEDIT.events.mouseDown(d.element,function(){d.updateOffsetLimits(),d.move()}),d.elementResize&&PEDIT.events.mouseDown(d.elementResize,function(){d.locked=!0,d.resize()}),d.elementRemove&&PEDIT.events.mouseDown(d.elementRemove,function(a){a=a||window.event,PEDIT.isTouchDevice&&a.preventDefault(),d.locked=!0,PEDIT.events.mouseUp(d.elementRemove,function(){d.remove()}),PEDIT.events.mouseUp(document,function(){d.locked=!1})}),d.updateOffsetLimits=function(){d.offsetLimitX=100-d.width,d.offsetLimitY=100-d.height},d.move=function(){var b=d.offsetX,c=d.offsetY;if(!d.locked){var e=function(e){e=e||window.event,PEDIT.isTouchDevice&&e.preventDefault();var f=PEDIT.tools.getPageXY(e);PEDIT.mouseEndX=f[0],PEDIT.mouseEndY=f[1],b=d.offsetX+a.calculateSize(PEDIT.mouseEndX-PEDIT.mouseStartX,!0),b=0>b?0:b,b=b>d.offsetLimitX?d.offsetLimitX:b,d.element.style.left=b+"%",c=d.offsetY+a.calculateSize(PEDIT.mouseEndY-PEDIT.mouseStartY,!1),c=0>c?0:c,c=c>d.offsetLimitY?d.offsetLimitY:c,d.element.style.top=c+"%"};PEDIT.events.mouseMove(document,e);var f=function(){PEDIT.events.mouseMove(document,e,!0),PEDIT.events.mouseUp(document,f,!0),d.offsetX=b,d.offsetY=c,"function"==typeof a.moveDoneFunction&&a.moveDoneFunction(d)};PEDIT.events.mouseUp(document,f)}},d.resize=function(){var b=function(b){b=b||window.event,PEDIT.isTouchDevice&&b.preventDefault();var c=PEDIT.tools.getPageXY(b);PEDIT.mouseStartX=c[0],PEDIT.mouseStartY=c[1];var e=d.height/d.width,f=PEDIT.mouseStartX-PEDIT.mouseEndX,g=f*f,h=PEDIT.mouseStartY-PEDIT.mouseEndY,i=h*h,j=1.5*Math.sqrt(g+i);j=f>=0&&h>=0?j:-j;var k=d.width+a.calculateSize(j,!0),l=e*k;d.updateElementSize(k,l),PEDIT.mouseEndX=c[0],PEDIT.mouseEndY=c[1]};PEDIT.events.mouseMove(document,b);var c=function(){PEDIT.events.mouseMove(document,b,!0),PEDIT.events.mouseUp(document,c,!0),d.locked=!1,"function"==typeof a.resizeDoneFunction&&a.resizeDoneFunction(d)};PEDIT.events.mouseUp(document,c)},d.updateElementSize=function(a,b){if(!(a>d.editor.childMaxWidth||a<d.editor.childMinWidth||b>d.editor.childMaxHeight||b<d.editor.childMinHeight)){var c=a-d.width,e=b-d.height;c>0?(d.width=a>99?100:a,d.height=b>99?100:b):(d.width=a,d.height=b),d.updateOffsetLimits(),d.element.style.width=d.width+"%",d.element.style.height=d.height+"%";var f=d.offsetX-c/2,g=d.offsetY-e/2;d.updateElementPosition(f,g)}},d.updateElementPosition=function(a,b){a=0>a?0:a>d.offsetLimitX?d.offsetLimitX:a,b=0>b?0:b>d.offsetLimitY?d.offsetLimitY:b,d.element.style.left=a+"%",d.element.style.top=b+"%",d.offsetX=a,d.offsetY=b},d.remove=function(){d.editor.element.removeChild(d.element),d.editor.children.splice(d.id,1)}}},PEDIT.events={mouseDown:function(a,b,c){this.bindEvent("down",a,b,c)},mouseUp:function(a,b,c){this.bindEvent("up",a,b,c)},mouseMove:function(a,b,c){this.bindEvent("move",a,b,c)},bindEvent:function(a,b,c,d){PEDIT.isTouchDevice?"down"===a?d?b.removeEventListener("touchstart",c,!1):b.addEventListener("touchstart",c,!1):"up"===a?d?b.removeEventListener("touchend",c,!1):b.addEventListener("touchend",c,!1):"move"===a&&(d?b.removeEventListener("touchmove",c,!1):b.addEventListener("touchmove",c,!1)):"down"===a?b.onmousedown=d?null:c:"up"===a?b.onmouseup=d?null:c:"move"===a&&(b.onmousemove=d?null:c)}},PEDIT.tools={isTouchDevice:function(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}},getPageXY:function(a){return"undefined"!=typeof a.touches?[a.touches[0].pageX,a.touches[0].pageY]:[a.pageX,a.pageY]},addTouchClass:function(a){var b=(" "+document.body.className+" ").indexOf(" "+a+" ")>-1;!b&&PEDIT.isTouchDevice&&(document.body.className+=""!==document.body.className?" "+a:a)},console:function(a,b){var c=document.getElementById("debug").innerHTML;c=b?a+"<br>"+c:a,document.getElementById("debug").innerHTML=c}};